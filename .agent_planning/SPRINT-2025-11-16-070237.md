# Sprint 1: Critical Catalog Rename Fix

**Sprint Duration**: TODAY (2025-11-16)
**Sprint Goal**: Unblock 74 failing tests and achieve 98%+ test pass rate
**Total Effort**: 30 minutes
**Priority**: P0 (CRITICAL - Blocking Ship)

---

## Sprint Overview

This is a focused 30-minute sprint to complete the incomplete registry.json → catalog.json migration. This is the only blocker preventing v2.0 from shipping.

**Why This Sprint Matters**:
- Fixes 74 failing tests (11% of suite)
- Unblocks info and add CLI commands
- Achieves production-ready status
- Enables v2.0 ship this week

**Evidence from STATUS**:
- Current: 603/692 tests passing (87%)
- Target: 677/692 tests passing (98%+)
- Blocker: Parameter naming inconsistency (registry_path vs catalog_path)

---

## Sprint Backlog

### Task 1: Delete Old Registry Files

**Priority**: P0
**Effort**: 5 minutes
**Assignee**: Developer
**Status**: Not Started

**Description**: Delete `data/registry.json` and `data/registry.cue` files that are superseded by catalog files.

**Commands**:
```bash
cd /Users/bmf/icode/mcpi
rm data/registry.json
rm data/registry.cue
git add data/
git status  # Verify only registry.* deleted
```

**Verification**:
```bash
pytest tests/test_catalog_rename.py::test_old_registry_files_do_not_exist -v
# Expected: PASSED
```

**Acceptance Criteria**:
- [ ] `data/registry.json` deleted
- [ ] `data/registry.cue` deleted
- [ ] `data/catalog.json` still exists (19 servers)
- [ ] `data/catalog.cue` still exists
- [ ] Test `test_old_registry_files_do_not_exist` passes
- [ ] Changes staged in git

**Dependencies**: None

---

### Task 2: Rename registry_path to catalog_path

**Priority**: P0
**Effort**: 20 minutes
**Assignee**: Developer
**Status**: Not Started

**Description**: Rename all occurrences of `registry_path` to `catalog_path` in ServerCatalog to match test API.

**Files to Modify**:
1. `src/mcpi/registry/catalog.py`

**Implementation Steps**:

1. **Find all occurrences**:
```bash
cd /Users/bmf/icode/mcpi
grep -n "registry_path" src/mcpi/registry/catalog.py
```

2. **Expected occurrences** (estimate 10):
   - Line ~134: Parameter in `__init__`
   - Line ~142: Instance variable assignment
   - Line ~157+: References in methods
   - Line ~215+: Factory function references
   - Comments and docstrings

3. **Rename pattern**:
```python
# Before
def __init__(self, registry_path: Path, validate_with_cue: bool = True):
    self.registry_path = registry_path

# After
def __init__(self, catalog_path: Path, validate_with_cue: bool = True):
    self.catalog_path = catalog_path
```

4. **Update all references**:
   - Constructor parameter: `registry_path` → `catalog_path`
   - Instance variable: `self.registry_path` → `self.catalog_path`
   - Method references: All uses of `self.registry_path`
   - Comments: "registry path" → "catalog path"
   - Docstrings: Update to say "catalog_path"

5. **Format code**:
```bash
black src/mcpi/registry/catalog.py
```

**Verification**:
```bash
# Run specific test suites
pytest tests/test_catalog_rename.py -v
pytest tests/test_registry_dependency_injection.py -v

# Both should show all tests PASSED
```

**Acceptance Criteria**:
- [ ] Parameter renamed to `catalog_path` in `__init__`
- [ ] Instance variable renamed to `self.catalog_path`
- [ ] All method references updated
- [ ] All comments/docstrings updated
- [ ] No grep matches for `registry_path` in catalog.py
- [ ] `test_catalog_rename.py` tests pass (6 tests)
- [ ] `test_registry_dependency_injection.py` tests pass (10 tests)
- [ ] Black formatting clean
- [ ] Changes staged in git

**Dependencies**: Task 1 (Delete Old Files)

---

### Task 3: Verify Full Test Suite Passes

**Priority**: P0
**Effort**: 5 minutes
**Assignee**: Developer
**Status**: Not Started

**Description**: Run full test suite to verify 98%+ pass rate achieved.

**Test Commands**:
```bash
cd /Users/bmf/icode/mcpi

# Full suite with minimal output
pytest --tb=no -q
# Expected: 677+ passed, 15 skipped

# Detailed test results
pytest -v --tb=short

# Coverage check
pytest --cov=src/mcpi --cov-report=term
# Expected: Coverage 60-70% (up from 9%)
```

**Specific Test Categories to Verify**:
```bash
# Catalog tests (should all pass)
pytest tests/test_catalog_rename.py -v

# DIP tests (should all pass)
pytest tests/test_registry_dependency_injection.py -v

# CLI tests (should mostly pass)
pytest tests/test_cli*.py -v

# Enable/disable tests (already passing)
pytest tests/test_enable_disable_bugs.py -v
```

**Success Metrics**:
- Total tests: 692
- Passing: 677+ (98%+)
- Failing: <15 (2%)
- Skipped: 15

**Acceptance Criteria**:
- [ ] Full test suite runs without errors
- [ ] Test pass rate ≥ 98%
- [ ] All catalog tests pass (6/6)
- [ ] All DIP tests pass (10/10)
- [ ] Enable/disable tests still pass (16/16)
- [ ] No new test failures introduced
- [ ] Coverage report shows improvement
- [ ] Test results documented

**Dependencies**: Task 2 (Rename Parameter)

---

## Sprint Commit Strategy

### Commit 1: Delete Old Registry Files

**After Task 1 completes**:
```bash
git add data/
git commit -m "fix(catalog): remove old registry.json and registry.cue files

- Delete data/registry.json (superseded by catalog.json)
- Delete data/registry.cue (superseded by catalog.cue)
- Fixes test_old_registry_files_do_not_exist
- Part of registry → catalog migration completion

Refs: STATUS-2025-11-16-070000.md section 4.1"
```

### Commit 2: Rename Parameter

**After Task 2 completes**:
```bash
git add src/mcpi/registry/catalog.py
git commit -m "fix(catalog): rename registry_path parameter to catalog_path

- Rename __init__ parameter: registry_path → catalog_path
- Rename instance variable: self.registry_path → self.catalog_path
- Update all method references and docstrings
- Fixes 74 failing tests (11% of suite)
- Completes registry → catalog migration

Fixes:
- test_catalog_rename.py (6 tests)
- test_registry_dependency_injection.py (10 tests)
- CLI integration tests (~30 tests)
- Functional workflow tests (~28 tests)

Test pass rate: 87% → 98%

Refs: STATUS-2025-11-16-070000.md section 4.1"
```

### Commit 3: Verify Tests (Optional)

**If any test fixes needed**:
```bash
git add tests/
git commit -m "test: update tests after catalog parameter rename

- Update test fixtures to use catalog_path
- Verify all catalog tests pass
- Verify all DIP tests pass

Test results: 677/692 passing (98%)"
```

---

## Sprint Definition of Done

### Code Quality Checklist

- [ ] All code changes implemented
- [ ] All code formatted with Black
- [ ] No linting errors (ruff clean)
- [ ] All type hints correct (mypy clean)
- [ ] All code reviewed for correctness
- [ ] No hardcoded values introduced
- [ ] No debug code left in place

### Testing Checklist

- [ ] All new/modified code tested
- [ ] All existing tests still pass
- [ ] Test pass rate ≥ 98%
- [ ] No flaky tests introduced
- [ ] Coverage maintained or improved
- [ ] Test results documented

### Documentation Checklist

- [ ] Code comments updated
- [ ] Docstrings updated
- [ ] Commit messages descriptive
- [ ] No outdated documentation

### Git Checklist

- [ ] All changes committed
- [ ] Commit messages follow conventions
- [ ] No unnecessary files committed
- [ ] Git status clean

---

## Sprint Execution Plan

### Time Boxed Schedule

**Total Duration**: 30 minutes

**Minute 0-5**: Task 1 - Delete Old Files
- Execute rm commands
- Verify files deleted
- Run test
- Stage changes
- Commit

**Minute 5-25**: Task 2 - Rename Parameter
- grep for occurrences
- Rename all instances
- Update comments/docstrings
- Format with Black
- Run tests
- Verify pass
- Stage changes
- Commit

**Minute 25-30**: Task 3 - Verify Full Suite
- Run pytest --tb=no -q
- Review results
- Document pass rate
- Verify 98%+ achieved
- Sprint complete

### Rollback Plan

**If Task 2 breaks tests unexpectedly**:
```bash
# Revert changes
git reset --hard HEAD~1

# Investigate issue
pytest tests/test_catalog_rename.py -v --tb=short

# Re-attempt with more careful rename
```

**If Task 3 shows <98% pass rate**:
```bash
# Investigate failures
pytest -v --tb=short | grep FAILED

# Fix any issues found
# Re-run verification
```

---

## Sprint Success Criteria

### Must Have (Blocking)

- [ ] All 3 tasks completed
- [ ] Test pass rate ≥ 98%
- [ ] All catalog tests pass
- [ ] All DIP tests pass
- [ ] Changes committed to git
- [ ] No regressions introduced

### Should Have (Important)

- [ ] Test execution time ≤ previous
- [ ] Code coverage maintained/improved
- [ ] All commits follow conventions
- [ ] No warnings in test output

### Nice to Have (Optional)

- [ ] Coverage report generated
- [ ] Test results documented in detail
- [ ] Sprint retrospective notes

---

## Sprint Risks and Mitigations

### Risk 1: Rename Misses Some Occurrences

**Probability**: Low
**Impact**: Medium (some tests still fail)
**Mitigation**:
- Use comprehensive grep search
- Search for variations (registry_path, registryPath, etc.)
- Run tests after each change
- Review diff carefully before commit

### Risk 2: Unexpected Test Failures

**Probability**: Low
**Impact**: High (blocks sprint)
**Mitigation**:
- Run tests incrementally
- Have rollback plan ready
- Keep changes minimal and focused
- Review test output carefully

### Risk 3: Time Overrun

**Probability**: Low
**Impact**: Low (just takes longer)
**Mitigation**:
- Focus on critical path
- Skip optional documentation updates
- Can complete in next session if needed

---

## Post-Sprint Actions

### Immediate (After Sprint)

1. **Verify CLI commands work**:
```bash
mcpi info playwright
mcpi add puppeteer --dry-run
mcpi search browser
```

2. **Update planning documents**:
   - Mark sprint as complete
   - Update backlog status
   - Document any issues found

3. **Communicate results**:
   - Report test pass rate achieved
   - Note any unexpected findings
   - Confirm ready for Sprint 2

### Next Sprint Prep

1. **Sprint 2 Planning**:
   - CLI verification (10 min)
   - Documentation (30 min)
   - Integration tests (2 hrs)

2. **Ship Preparation**:
   - Review ship checklist
   - Prepare release notes
   - Tag v2.0 release

---

## Sprint Retrospective Template

**After sprint completion, document**:

### What Went Well
- [ ] Tasks completed on time
- [ ] Test pass rate achieved
- [ ] No unexpected issues
- [ ] Other: ___________

### What Could Improve
- [ ] Better time estimation
- [ ] More thorough testing
- [ ] Clearer acceptance criteria
- [ ] Other: ___________

### Action Items for Next Sprint
- [ ] Action 1: ___________
- [ ] Action 2: ___________
- [ ] Action 3: ___________

### Notes
[Free-form notes about sprint execution]

---

**END OF SPRINT PLAN**

Sprint: Sprint 1 - Critical Catalog Rename Fix
Duration: 30 minutes
Goal: 98%+ test pass rate
Status: Ready to Execute
