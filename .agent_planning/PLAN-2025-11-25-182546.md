# MCPI Prioritized Backlog - Post-v0.5.0 Release

**Generated**: 2025-11-25 18:25:46
**Source STATUS**: STATUS-2025-11-25-181931.md
**Spec Reference**: CLAUDE.md, PROJECT_SPEC.md
**Current Version**: v0.5.0 (shipped)
**Next Target**: v0.6.0 (library complete, CLI incomplete)

---

## Executive Summary

### Current State

**Project Health**: EXCELLENT
- 94.2% test pass rate (949/1007 tests)
- Zero TODOs/FIXMEs in source code
- Clean architecture with DIP compliance
- Multiple shipped, production-ready versions

**Shipped Versions**:
- v0.5.0 (Configuration Templates) - SHIPPED ✓
- v0.4.0 (Multi-Catalog Support) - SHIPPED ✓
- v0.3.0 (User-Internal Disable Mechanism) - SHIPPED ✓
- v2.0 (Dependency Injection Architecture) - SHIPPED ✓

**In-Progress Work**:
- v0.6.0 Template Discovery Engine - Library 100% complete, CLI 0% complete

### Critical Issues (P0)

**2 Critical Blockers Identified**:

1. **Template-to-Server-ID Mapping Broken** (MCPI-l93)
   - Templates use 'postgres', catalog uses 'modelcontextprotocol/postgres'
   - Breaks v0.5.0 shipped feature for all namespaced servers
   - Users cannot access templates for postgres, github, filesystem, etc.
   - Fix: 2-4 hours

2. **Plugin Discovery Implementation Unclear** (MCPI-2uh)
   - Contradictory evidence about feature existence
   - May break parity with Claude Code
   - Requires investigation + potential implementation
   - Fix: 2 hours investigation + 4-8 hours if missing

### Next Milestone: v0.6.0

**Completion Status**: 80% (12/15 components)
- Library: 100% complete (19/19 tests passing)
- CLI: 0% complete (3 components not started)
- Timeline: 10 hours remaining (2-3 days)

### Test Health

- 1 test failure (missing 'toml' dependency - trivial fix)
- 57 skipped tests (requires investigation)
- 16 deprecation warnings (cleanup needed)

---

## Backlog by Priority

### P0 (Critical) - 2 Issues

Issues that block shipped features or break core functionality. **MUST** be fixed immediately.

---

#### MCPI-l93: Fix template-to-server-ID mapping for namespaced servers

**Type**: Bug
**Effort**: MEDIUM (2-4 hours)
**Status**: Ready to work
**Dependencies**: None

**Problem**:
Templates use server_id='postgres' but catalog uses 'modelcontextprotocol/postgres'. This breaks template discovery for ALL namespaced servers in the v0.5.0 shipped feature.

**Evidence**:
- `mcpi add postgres --list-templates` fails (server not found)
- `mcpi add modelcontextprotocol/postgres --list-templates` fails (no templates)
- Templates in data/templates/postgres/*.yaml have `server_id: postgres`
- Catalog has `modelcontextprotocol/postgres`

**Impact**: HIGH
- Users cannot use templates for postgres, github, filesystem, slack, brave-search
- Breaks core v0.5.0 feature that reduces setup time by 87%

**Recommended Solution**:
Implement fuzzy matching in TemplateManager.list_templates() to strip namespace prefix when looking up templates.

**Acceptance Criteria**:
- [ ] `mcpi add postgres --list-templates` shows templates
- [ ] `mcpi add modelcontextprotocol/postgres --list-templates` shows templates
- [ ] All 12 existing templates work with both simple and namespaced IDs
- [ ] New tests cover both simple and namespaced server ID lookups
- [ ] Template system works for github, filesystem, slack, brave-search

**Implementation Plan**:
1. Update `TemplateManager.list_templates()` to accept namespaced IDs
2. Strip namespace prefix (e.g., 'modelcontextprotocol/') when looking up template directories
3. Add fallback logic: try full ID first, then try ID with namespace stripped
4. Update tests to verify both 'postgres' and 'modelcontextprotocol/postgres' work

**Files to Modify**:
- `src/mcpi/templates/template_manager.py`
- `tests/test_template_manager.py` (add new test cases)

---

#### MCPI-2uh: Investigate plugin-based MCP server discovery implementation status

**Type**: Investigation Task
**Effort**: MEDIUM (2 hours investigation + 4-8 hours implementation if needed)
**Status**: Ready to work
**Dependencies**: None

**Problem**:
Contradictory evidence about whether plugin-based MCP discovery is implemented:
- STATUS-mcpi-list-bugs.md (Nov 24) says feature NOT implemented
- Runtime shows 'beads:beads' server with plugin scope working
- Unclear if feature exists, is hacky, or is missing

**Evidence of Feature Working**:
- `mcpi list` shows: `beads:beads | claude-code | plugin | ENABLED | uv`

**Evidence of Feature Missing**:
- STATUS-mcpi-list-bugs.md analysis says no PluginBasedScope implementation
- ClaudeCodePlugin may have no plugin scope handler
- Architecture analysis indicates missing feature

**Impact**: HIGH
- Potential missing servers in `mcpi list` output
- Breaks parity with `claude mcp list`
- Unclear architectural state

**Investigation Required**:
1. Review ClaudeCodePlugin._initialize_scopes()
2. Check for any PluginBasedScope implementation in codebase
3. Determine how 'beads:beads' appears in `mcpi list` output
4. Compare `mcpi list` vs `claude mcp list` output for plugin servers
5. Document actual implementation vs expected architecture

**Acceptance Criteria**:
- [ ] Determine actual implementation status (working/missing/hacky)
- [ ] Document findings in investigation report
- [ ] If missing: create follow-up issue for implementation
- [ ] If exists: verify mcpi list shows all plugin servers that claude mcp list shows
- [ ] If hacky: create follow-up issue for refactoring
- [ ] Update CLAUDE.md with accurate plugin discovery documentation

**Next Actions Based on Findings**:
- **If Missing**: Implement Solution 1 from STATUS-mcpi-list-bugs.md (4-8 hours)
- **If Exists**: Update documentation and close issue
- **If Hacky**: Create refactoring issue and add to P2 backlog

**Files to Review**:
- `src/mcpi/clients/claude_code.py` (ClaudeCodePlugin initialization)
- `src/mcpi/clients/base.py` (scope implementations)
- `.agent_planning/STATUS-mcpi-list-bugs.md` (analysis document)

---

### P1 (High) - 3 Issues

Features that are complete but inaccessible to users. Required to ship v0.6.0.

**Note**: Issues MCPI-0jp and MCPI-q76 can be worked in parallel. MCPI-6cm depends on both completing.

---

#### MCPI-0jp: Complete v0.6.0 Template Discovery CLI integration - Add --recommend flag

**Type**: Feature
**Effort**: SMALL (3 hours)
**Status**: Ready to work
**Dependencies**: None
**Blocks**: MCPI-6cm (Interactive selection flow)

**Problem**:
Template Discovery Engine library is 100% complete (19/19 tests passing, 91% coverage), but the --recommend flag doesn't exist in the CLI. Users cannot access this production-ready feature.

**Library Status**: COMPLETE ✓
- ProjectDetector: Working, tested, fast (<100ms)
- TemplateRecommender: Working, tested, accurate
- All 19 library tests passing

**CLI Status**: NOT STARTED ✗
- --recommend flag does not exist
- No integration with CLI add command

**Acceptance Criteria**:
- [ ] `mcpi add <server> --recommend` flag exists
- [ ] Flag triggers project detection and recommendation engine
- [ ] Recommendations passed to display layer (MCPI-q76)
- [ ] Flag documented in `mcpi add --help`
- [ ] Integration tests pass for --recommend flag

**Implementation Plan**:
1. Add --recommend boolean flag to cli.py add command
2. When flag present, call ProjectDetector.detect()
3. Pass ProjectContext to TemplateRecommender
4. Get list of TemplateRecommendation objects
5. Pass recommendations to Rich display handler (depends on MCPI-q76)
6. Wire into interactive flow (depends on MCPI-6cm)

**Files to Modify**:
- `src/mcpi/cli.py` (add command)
- `tests/test_template_recommendation_cli.py` (CLI integration tests)

---

#### MCPI-q76: Complete v0.6.0 Template Discovery CLI integration - Rich display for recommendations

**Type**: Feature
**Effort**: MEDIUM (4 hours)
**Status**: Ready to work
**Dependencies**: None
**Blocks**: MCPI-6cm (Interactive selection flow)

**Problem**:
Need user-friendly display for template recommendations showing confidence scores, reasons, and visual hierarchy.

**Requirements**:
- Recommended templates with confidence scores
- Reasons why each template is recommended
- Server requirements and configuration preview
- Visual hierarchy and color coding

**Acceptance Criteria**:
- [ ] Rich table displays recommendations sorted by confidence
- [ ] Confidence scores shown with visual indicators (colors, symbols)
- [ ] Recommendation reasons displayed clearly
- [ ] Template metadata shown (name, description, scope)
- [ ] Display is readable and user-friendly
- [ ] Unit tests for display formatting

**Implementation Plan**:
1. Create display_recommendations() function using Rich library
2. Build Rich table with columns: Rank, Template, Confidence, Reasons
3. Use color coding: green (high confidence >0.7), yellow (medium 0.4-0.7), red (low <0.4)
4. Format confidence as percentage with progress bar
5. Show top recommendation with special highlighting
6. Add footer with instructions for selection

**Files to Create**:
- `src/mcpi/cli_display.py` (new module for Rich display functions)

**Files to Modify**:
- `tests/test_template_recommendation_cli.py` (display tests)

---

#### MCPI-6cm: Complete v0.6.0 Template Discovery CLI integration - Interactive selection flow

**Type**: Feature
**Effort**: SMALL (3 hours)
**Status**: Blocked (depends on MCPI-0jp and MCPI-q76)
**Dependencies**: MCPI-0jp (flag), MCPI-q76 (display)

**Problem**:
Need interactive flow for users to accept/decline template recommendations.

**User Flow**:
1. Display recommendations (using MCPI-q76)
2. Prompt user to select a recommendation or decline
3. On acceptance: proceed with selected template
4. On decline: fall back to manual template selection or standard flow

**Acceptance Criteria**:
- [ ] User prompted to select from recommendations (1-N or decline)
- [ ] Selection validated (integer in range or 0)
- [ ] On acceptance: selected template used for server configuration
- [ ] On decline: fallback to standard add flow
- [ ] Error handling for invalid input
- [ ] E2E tests for full interactive flow

**Implementation Plan**:
1. After displaying recommendations, prompt: 'Select recommendation (1-N) or decline (0):'
2. Validate input (integer in range or 0)
3. If valid selection: proceed with add using selected template
4. If decline (0): continue to standard add flow (--list-templates or manual config)
5. If invalid: re-prompt with error message
6. Wire into existing add command flow

**Files to Modify**:
- `src/mcpi/cli.py` (add command - interactive flow)
- `tests/test_template_recommendation_cli.py` (E2E tests)

---

### P2 (Medium) - 2 Issues

Technical debt and improvements that enhance maintainability but don't block features.

---

#### MCPI-iv7: Investigate and fix 57 skipped tests

**Type**: Investigation Task
**Effort**: MEDIUM (4-8 hours)
**Status**: Ready to work
**Dependencies**: None

**Problem**:
Test suite shows 57 tests skipped (5.7% of total). These may indicate disabled features, incomplete implementations, platform-specific tests, or outdated tests.

**Evidence**:
- pytest output: "949 passed, 57 skipped"
- Unknown reason for skips
- May impact test coverage metrics

**Investigation Required**:
1. Run pytest -v to get list of all skipped tests
2. Review each test file to find @pytest.mark.skip decorators
3. Check git history to see when/why tests were skipped
4. Verify if corresponding features are implemented
5. Categorize skips: platform-specific, disabled feature, outdated test
6. Create action plan for each category

**Acceptance Criteria**:
- [ ] All 57 skipped tests reviewed
- [ ] Reason documented for each skip
- [ ] Tests unskipped if features are complete
- [ ] Tests updated if implementation changed
- [ ] Tests removed if no longer relevant
- [ ] Follow-up issues created for missing features
- [ ] Target: <10 skipped tests remaining

**Expected Outcomes**:
- Clear understanding of skipped tests
- Improved test coverage
- Identification of missing features or technical debt
- Better test suite health

---

#### MCPI-dsg: Refactor cli.py into modular command structure

**Type**: Technical Debt
**Effort**: LARGE (8-16 hours)
**Status**: Ready to work
**Dependencies**: None

**Problem**:
cli.py is 95KB in a single file, making it hard to maintain and navigate. This is acknowledged technical debt in PROJECT_SPEC.md line 348.

**Current**: Single monolithic file with all commands
**Target**: Modular structure with commands in separate modules

**Benefits**:
- Improved maintainability
- Easier to locate and update specific commands
- Better separation of concerns
- Follows SOLID principles

**Acceptance Criteria**:
- [ ] cli.py main file <20KB
- [ ] Commands extracted to separate modules (e.g., commands/add.py, commands/list.py)
- [ ] All CLI tests still pass
- [ ] No functionality changes
- [ ] Import structure clean and logical
- [ ] Documentation updated to reflect new structure

**Implementation Plan**:
1. Create src/mcpi/cli/commands/ directory
2. Extract each command group to separate module:
   - add.py: add, remove commands
   - list.py: list, status commands
   - scope.py: scope list, scope show, rescope
   - catalog.py: catalog list, catalog info
   - client.py: client list, client info, client set-default
3. Keep main cli.py as entry point that imports commands
4. Use Click command groups for organization
5. Migrate incrementally, test after each extraction

**Recommended Approach**:
- Work incrementally: extract one command group at a time
- Run full test suite after each extraction
- Ensure no functionality changes (refactoring only)

---

### P3 (Low) - 2 Issues

Minor bugs and cleanup tasks that improve quality but don't block features.

---

#### MCPI-bfh: Fix test environment missing 'toml' dependency

**Type**: Bug
**Effort**: TRIVIAL (30 minutes)
**Status**: Ready to work
**Dependencies**: None

**Problem**:
One test fails due to missing 'toml' module in test environment.

**Test**: tests/test_functional_cli_workflows.py::TestCLIBasicCommands::test_list_command_workflow
**Error**: AssertionError: Should show filesystem server. Output: Error listing servers: No module named 'toml'

**Root Cause**: 'toml' is in pyproject.toml dependencies but not installed in test environment

**Impact**: LOW - Runtime works fine, only affects this one test

**Acceptance Criteria**:
- [ ] test_list_command_workflow passes
- [ ] toml module available in test environment
- [ ] All 950 runnable tests pass (100%)
- [ ] CI pipeline includes toml dependency

**Implementation Plan**:
1. Check pyproject.toml [project.dependencies] for toml
2. Check pyproject.toml [project.optional-dependencies.dev] for toml
3. Add toml to appropriate dependency section if missing
4. Run uv sync --dev to update environment
5. Verify test passes

---

#### MCPI-zw2: Update tests to eliminate deprecation warnings

**Type**: Cleanup
**Effort**: SMALL (2-4 hours)
**Status**: Ready to work
**Dependencies**: None

**Problem**:
Test suite shows 16 deprecation warnings for old API usage.

**Warning**: create_default_catalog() is deprecated. Use create_default_catalog_manager()

**Impact**: LOW - Old API still works, warnings are just noise

**Purpose**: Cleanup work to improve test output quality and ensure tests use current best practices.

**Acceptance Criteria**:
- [ ] Zero deprecation warnings in test output
- [ ] All tests use create_default_catalog_manager()
- [ ] No tests use deprecated create_default_catalog()
- [ ] Test pass rate remains 100%

**Implementation Plan**:
1. Search codebase for create_default_catalog() calls in tests/
2. Replace with create_default_catalog_manager()
3. Update any related code that uses catalog directly
4. Run tests to verify no regressions
5. Verify deprecation warnings gone

---

## Dependency Graph

```
P0 Issues (No dependencies):
- MCPI-l93: Fix template-to-server-ID mapping
- MCPI-2uh: Investigate plugin discovery

P1 Issues (v0.6.0):
- MCPI-0jp: Add --recommend flag (no dependencies)
- MCPI-q76: Rich display (no dependencies)
- MCPI-6cm: Interactive flow (depends on MCPI-0jp AND MCPI-q76)

P2 Issues (No dependencies):
- MCPI-iv7: Investigate 57 skipped tests
- MCPI-dsg: Refactor cli.py

P3 Issues (No dependencies):
- MCPI-bfh: Fix toml dependency
- MCPI-zw2: Update deprecation warnings
```

**Critical Path for v0.6.0**:
1. MCPI-0jp (3 hours) + MCPI-q76 (4 hours) can run in parallel
2. MCPI-6cm (3 hours) must wait for both to complete
3. Total sequential time: 7 hours (flag + display in parallel, then interactive)
4. Total estimated time: 10 hours (with testing and integration)

---

## Recommended Sprint Planning

### Sprint 1: Critical Bugs (Week 1 - Days 1-2)

**Goal**: Fix P0 blockers that break shipped features

**Issues**:
1. MCPI-l93: Fix template-to-server-ID mapping (2-4 hours)
2. MCPI-2uh: Investigate plugin discovery (2 hours investigation)

**Success Criteria**:
- Templates work for all namespaced servers
- Plugin discovery implementation status documented
- Follow-up issues created if needed

**Timeline**: 2 days
**Risk**: LOW - Well-defined problems with clear solutions

---

### Sprint 2: v0.6.0 CLI Integration (Week 1 - Days 3-5)

**Goal**: Complete v0.6.0 Template Discovery CLI and ship

**Issues**:
1. MCPI-0jp: Add --recommend flag (3 hours)
2. MCPI-q76: Rich display (4 hours) - **parallel with above**
3. MCPI-6cm: Interactive flow (3 hours) - **sequential after 1 & 2**

**Success Criteria**:
- `mcpi add <server> --recommend` works end-to-end
- Rich display shows recommendations clearly
- Interactive selection flow works
- All 12 CLI tests pass
- v0.6.0 ready to ship

**Timeline**: 3 days
**Risk**: LOW - Library complete, just needs CLI wiring

---

### Sprint 3: Test Health & Cleanup (Week 2)

**Goal**: Improve test suite health and code quality

**Issues**:
1. MCPI-bfh: Fix toml dependency (30 minutes) - **Quick win**
2. MCPI-iv7: Investigate 57 skipped tests (4-8 hours)
3. MCPI-zw2: Update deprecation warnings (2-4 hours)

**Success Criteria**:
- 100% of runnable tests pass
- <10 skipped tests remaining
- Zero deprecation warnings
- Clear understanding of test suite health

**Timeline**: 2-3 days
**Risk**: MEDIUM - Unknown why tests are skipped

---

### Sprint 4: Technical Debt (Week 3 - Optional)

**Goal**: Refactor cli.py for better maintainability

**Issues**:
1. MCPI-dsg: Refactor cli.py into modular structure (8-16 hours)

**Success Criteria**:
- cli.py <20KB
- Commands in separate modules
- All tests still pass
- No functionality changes

**Timeline**: 3-4 days
**Risk**: MEDIUM - Large refactoring, high test coverage required

---

## Risk Assessment

### High-Risk Items

**MCPI-2uh: Plugin Discovery Investigation**
- **Risk**: Unknown implementation state
- **Impact**: May require 4-8 hours additional work if missing
- **Mitigation**: Prioritize investigation early in Sprint 1
- **Contingency**: If hacky implementation found, create P2 refactoring issue

**MCPI-iv7: 57 Skipped Tests**
- **Risk**: Unknown reason for skips, may uncover missing features
- **Impact**: Could reveal larger issues or incomplete implementations
- **Mitigation**: Categorize skips early, create follow-up issues for missing features
- **Contingency**: If features missing, add to future sprint backlog

### Medium-Risk Items

**MCPI-dsg: cli.py Refactoring**
- **Risk**: Large file, many dependencies, high chance of breaking tests
- **Impact**: Could introduce regressions if not careful
- **Mitigation**: Work incrementally, extract one command group at a time
- **Contingency**: If tests break, revert and adjust approach

### Low-Risk Items

All P0 and P1 issues have clear scopes and well-defined solutions. Library code for v0.6.0 is complete and tested, reducing integration risk.

---

## Summary Statistics

### Issue Breakdown

| Priority | Count | Type Breakdown | Total Effort |
|----------|-------|----------------|--------------|
| P0 (Critical) | 2 | 1 bug, 1 investigation | 6-12 hours |
| P1 (High) | 3 | 3 features | 10 hours |
| P2 (Medium) | 2 | 1 investigation, 1 chore | 12-24 hours |
| P3 (Low) | 2 | 1 bug, 1 chore | 2.5-4.5 hours |
| **Total** | **9** | **2 bugs, 2 investigations, 3 features, 2 chores** | **30.5-50.5 hours** |

### Complexity Distribution

- **Trivial** (MCPI-bfh): 1 issue, 30 minutes
- **Small** (MCPI-0jp, MCPI-6cm, MCPI-zw2): 3 issues, 8-10 hours
- **Medium** (MCPI-l93, MCPI-2uh, MCPI-q76, MCPI-iv7): 4 issues, 12-26 hours
- **Large** (MCPI-dsg): 1 issue, 8-16 hours

### Ready to Work

**8/9 issues ready to start immediately**
- 1 issue blocked (MCPI-6cm) - depends on 2 P1 issues

**11 issues with zero blockers** (per beads stats)

### Ship Readiness

**v0.5.0**: SHIPPED but BROKEN for namespaced servers (MCPI-l93)
**v0.6.0**: LIBRARY READY, CLI needs 10 hours work
**Overall Project**: PRODUCTION READY with 2 critical bugs

**Recommendation**:
1. Fix MCPI-l93 IMMEDIATELY (same day)
2. Investigate MCPI-2uh (1 day)
3. Ship v0.6.0 within 1 week

---

## Planning File Provenance

**Source STATUS File**: STATUS-2025-11-25-181931.md (generated 2025-11-25 18:19:31)
**Spec Version**: CLAUDE.md (last modified 2025-11-25)
**Generation Timestamp**: 2025-11-25 18:25:46
**Generated By**: Backlog Builder Agent (Evidence-Based Planning)

**Evidence Sources**:
- Runtime verification (mcpi list, mcpi search, mcpi catalog list)
- Test results (pytest output: 949 passed, 1 failed, 57 skipped)
- Code metrics (57 Python files, 8,660 lines, 95KB cli.py)
- Git status (clean working directory, v0.5.0 shipped)

**Next Planning Update**: After completing P0 issues or when v0.6.0 ships

---

## Notes

**File Retention Policy**: Keep 4 most recent PLAN-*.md files, archive older ones

**Current Planning Files**:
1. PLAN-2025-11-25-182546.md (this file - latest)
2. PLAN-CLI-INTEGRATION-v0.6.0-2025-11-18-145319.md (v0.6.0 planning)
3. Previous plans in .agent_planning/archive/

**Status Report Alignment**: This backlog consumes STATUS-2025-11-25-181931.md as the single source of truth for current implementation state. All evidence and findings are directly traceable to that report.

**Backlog vs Issue Tracker**: All issues have been created in the beads issue tracker. Use `bd list` or beads MCP tools to view and manage work items.

---

**End of Backlog**

Generated with evidence-based planning methodology.
Zero speculation, 100% traceability.
